        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>RSAKey Class / solvr:bignum Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="solvr:bignum" data-type="RSAKey">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../solvr_bignum.html">solvr:bignum</a> &rsaquo; <a href="../solvr_bignum/RSAKey.html">RSAKey</a></div>
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>RSAKey</strong>
          Class
        </h2>
        
<div class="doc">

</div>
<h3>Constructors</h3>
<div class="method"><h4 id="RSAKey">
<span class="show-code">Code</span>
new <strong>RSAKey</strong>() <a class="anchor-link" href="#RSAKey"
              title="Permalink to RSAKey.RSAKey">#</a></h4>
<div class="doc">

<pre class="source">
RSAKey() {
  this.n = null;
  this.e = 0;
  this.d = null;
  this.p = null;
  this.q = null;
  this.dmp1 = null;
  this.dmq1 = null;
  this.coeff = null;
}
</pre>
</div>
</div>
<h3>Methods</h3>
<div class="method"><h4 id="decrypt">
<span class="show-code">Code</span>
<strong>decrypt</strong>(ctext) <a class="anchor-link" href="#decrypt"
              title="Permalink to RSAKey.decrypt">#</a></h4>
<div class="doc">

<pre class="source">
decrypt(ctext) {
  var c = parseBigInt(ctext, 16);
  var m = this.doPrivate(c);
  if(m == null) return null;
  return pkcs1unpad2(m, (this.n.bitLength()+7)&gt;&gt;3);
}
</pre>
</div>
</div>
<div class="method"><h4 id="doPrivate">
<span class="show-code">Code</span>
<strong>doPrivate</strong>(x) <a class="anchor-link" href="#doPrivate"
              title="Permalink to RSAKey.doPrivate">#</a></h4>
<div class="doc">

<pre class="source">
doPrivate(x) {
  if(this.p == null || this.q == null)
    return x.modPow(this.d, this.n);

  // TODO: re-calculate any missing CRT params
  var xp = x.mod(this.p).modPow(this.dmp1, this.p);
  var xq = x.mod(this.q).modPow(this.dmq1, this.q);

  while(xp.compareTo(xq) &lt; 0)
    xp = xp.add(this.p);
  return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq);
}
</pre>
</div>
</div>
<div class="method"><h4 id="doPublic">
<span class="show-code">Code</span>
<strong>doPublic</strong>(x) <a class="anchor-link" href="#doPublic"
              title="Permalink to RSAKey.doPublic">#</a></h4>
<div class="doc">

<pre class="source">
doPublic(x) {
  return x.modPowInt(this.e, this.n);
}
</pre>
</div>
</div>
<div class="method"><h4 id="encrypt">
<span class="show-code">Code</span>
<strong>encrypt</strong>(text) <a class="anchor-link" href="#encrypt"
              title="Permalink to RSAKey.encrypt">#</a></h4>
<div class="doc">

<pre class="source">
encrypt(text) {
  var m = pkcs1pad2(text,(this.n.bitLength()+7)&gt;&gt;3);
  if(m == null) return null;
  var c = this.doPublic(m);
  if(c == null) return null;
  var h = c.toString(16);
  if((h.length &amp; 1) == 0) { 
      return h;  
    } else { 
      //return "0" + h; 
      return "0${h}"; 
    }
}
</pre>
</div>
</div>
<div class="method"><h4 id="generate">
<span class="show-code">Code</span>
<strong>generate</strong>(B, E) <a class="anchor-link" href="#generate"
              title="Permalink to RSAKey.generate">#</a></h4>
<div class="doc">

<pre class="source">
generate(B,E) {
  var rng = new SecureRandom();
  var qs = B&gt;&gt;1;
  //this.e = parseInt(E,16);
  this.e = Fixnum.int32.parseHex(E).toInt();
  var ee = new BigInteger(E,16);
  for(;;) {
    for(;;) {
      this.p = new BigInteger(B-qs,1,rng);
      if(this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 &amp;&amp; this.p.isProbablePrime(10)) break;
    }
    for(;;) {
      this.q = new BigInteger(qs,1,rng);
      if(this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 &amp;&amp; this.q.isProbablePrime(10)) break;
    }
    if(this.p.compareTo(this.q) &lt;= 0) {
      var t = this.p;
      this.p = this.q;
      this.q = t;
    }
    var p1 = this.p.subtract(BigInteger.ONE);
    var q1 = this.q.subtract(BigInteger.ONE);
    var phi = p1.multiply(q1);
    if(phi.gcd(ee).compareTo(BigInteger.ONE) == 0) {
      this.n = this.p.multiply(this.q);
      this.d = ee.modInverse(phi);
      this.dmp1 = this.d.mod(p1);
      this.dmq1 = this.d.mod(q1);
      this.coeff = this.q.modInverse(this.p);
      break;
    }
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="pkcs1unpad2">
<span class="show-code">Code</span>
<strong>pkcs1unpad2</strong>(d, n) <a class="anchor-link" href="#pkcs1unpad2"
              title="Permalink to RSAKey.pkcs1unpad2">#</a></h4>
<div class="doc">

<pre class="source">
pkcs1unpad2(d,n) {
  var b = d.toByteArray();
  var i = 0;
  while(i &lt; b.length &amp;&amp; b[i] == 0) ++i;
  if(b.length-i != n-1 || b[i] != 2)
    return null;
  ++i;
  while(b[i] != 0)
    if(++i &gt;= b.length) return null;
  var ret = "";
  while(++i &lt; b.length) {
    var c = new String.fromCharCodes([b[i]]);
    ret = "$ret${c}";
  }
    //ret += String.fromCharCode(b[i]);
  return ret;
}
</pre>
</div>
</div>
<div class="method"><h4 id="setPrivate">
<span class="show-code">Code</span>
<strong>setPrivate</strong>(N, E, D) <a class="anchor-link" href="#setPrivate"
              title="Permalink to RSAKey.setPrivate">#</a></h4>
<div class="doc">

<pre class="source">
setPrivate(N,E,D) {
  if(N != null &amp;&amp; E != null &amp;&amp; N.length &gt; 0 &amp;&amp; E.length &gt; 0) {
    this.n = parseBigInt(N,16);
    //this.e = parseInt(E,16);
    this.e = Fixnum.int32.parseHex(E).toInt();
    this.d = parseBigInt(D,16);
  }
  else
    print("Invalid RSA private key");
}
</pre>
</div>
</div>
<div class="method"><h4 id="setPrivateEx">
<span class="show-code">Code</span>
<strong>setPrivateEx</strong>(N, E, D, P, Q, DP, DQ, C) <a class="anchor-link" href="#setPrivateEx"
              title="Permalink to RSAKey.setPrivateEx">#</a></h4>
<div class="doc">

<pre class="source">
setPrivateEx(N,E,D,P,Q,DP,DQ,C) {
  if(N != null &amp;&amp; E != null &amp;&amp; N.length &gt; 0 &amp;&amp; E.length &gt; 0) {
    this.n = parseBigInt(N,16);
    //this.e = parseInt(E,16);
    this.e = Fixnum.int32.parseHex(E).toInt();
    this.d = parseBigInt(D,16);
    this.p = parseBigInt(P,16);
    this.q = parseBigInt(Q,16);
    this.dmp1 = parseBigInt(DP,16);
    this.dmq1 = parseBigInt(DQ,16);
    this.coeff = parseBigInt(C,16);
  }
  else
    print("Invalid RSA private key");
}
</pre>
</div>
</div>
<div class="method"><h4 id="setPublic">
<span class="show-code">Code</span>
<strong>setPublic</strong>(N, E) <a class="anchor-link" href="#setPublic"
              title="Permalink to RSAKey.setPublic">#</a></h4>
<div class="doc">

<pre class="source">
setPublic(N,E) {
  if(N != null &amp;&amp; E != null &amp;&amp; N.length &gt; 0 &amp;&amp; E.length &gt; 0) {
    this.n = parseBigInt(N,16);
    //this.e = parseInt(E,16);
    this.e = Fixnum.int32.parseHex(E).toInt();
    //Mathx.parseInt("A");
  }
  else
    print("Invalid RSA public key");
}
</pre>
</div>
</div>
<h3>Fields</h3>
<div class="field"><h4 id="coeff">
<span class="show-code">Code</span>
var         <strong>coeff</strong> <a class="anchor-link"
            href="#coeff"
            title="Permalink to RSAKey.coeff">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var coeff;
</pre>
</div>
</div>
<div class="field"><h4 id="d">
<span class="show-code">Code</span>
var         <strong>d</strong> <a class="anchor-link"
            href="#d"
            title="Permalink to RSAKey.d">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var d;
</pre>
</div>
</div>
<div class="field"><h4 id="dmp1">
<span class="show-code">Code</span>
var         <strong>dmp1</strong> <a class="anchor-link"
            href="#dmp1"
            title="Permalink to RSAKey.dmp1">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var dmp1;
</pre>
</div>
</div>
<div class="field"><h4 id="dmq1">
<span class="show-code">Code</span>
var         <strong>dmq1</strong> <a class="anchor-link"
            href="#dmq1"
            title="Permalink to RSAKey.dmq1">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var dmq1;
</pre>
</div>
</div>
<div class="field"><h4 id="e">
<span class="show-code">Code</span>
var         <strong>e</strong> <a class="anchor-link"
            href="#e"
            title="Permalink to RSAKey.e">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var e;
</pre>
</div>
</div>
<div class="field"><h4 id="n">
<span class="show-code">Code</span>
var         <strong>n</strong> <a class="anchor-link"
            href="#n"
            title="Permalink to RSAKey.n">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var n;
</pre>
</div>
</div>
<div class="field"><h4 id="p">
<span class="show-code">Code</span>
var         <strong>p</strong> <a class="anchor-link"
            href="#p"
            title="Permalink to RSAKey.p">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var p;
</pre>
</div>
</div>
<div class="field"><h4 id="q">
<span class="show-code">Code</span>
var         <strong>q</strong> <a class="anchor-link"
            href="#q"
            title="Permalink to RSAKey.q">#</a>
        </h4>
        <div class="doc">

<pre class="source">
var q;
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page was generated at 2012-08-29 12:31:51.207</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
